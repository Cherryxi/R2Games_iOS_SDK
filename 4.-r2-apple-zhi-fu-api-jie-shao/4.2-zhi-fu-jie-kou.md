# 4.2支付接口

**功能说明：**

研发方可以直接调用该接口来让玩家完成某一IAP产品的支付。接口的回调可以作为参考值，但是最终的发货请以和SDK服务器发货接口返回的结果为准。

**接口形式：**

```objectivec
-(void)payV2FromViewController:(UIViewController*)gameViewController
   usingLoadingView:(BOOL)yesOrNo
          productId:(NSString*)productId
           serverId:(NSString*)serverId
             roleId:(NSString*)roleid
           roleName:(NSString*)roleName
          roleLevel:(int)roleLevel
            gameCno:(NSString*)gameCno
          extraData:(NSString*)extraData
onCompletionHandler:(R2SDKPayCompletionHandler)handler;
```

**参数说明：**

gameViewController:当前活动的UIViewController （必须）  
gameCno：游戏服务器产生的唯一订单号（必须）  
productId: 苹果itunesconnect应用管理后台上定义的支付产品ID （必须）  
serverId : 当前玩家所处服务器唯一标示ID（必须）  
yesOrNo: 支付过程中是否需要显示加载框（可选）  
roleid : 当前玩家游戏内的唯一角色标识符（可选）  
roleName: 当前玩家游戏内的角色名（可选）  
roleLevel: 当前玩家角色等级（可选）  
extraData：R2支付可自定义额外数据（透传字段，根据需求传入透传值）（可选）  
handler：接口回调（必须）

**接口示例：**

```objectivec
 [[R2V2AppleIAP sharedInstance]payV2FromViewController:self usingLoadingView:YES productId:@"2232" serverId:@"80001" roleId:@"123030" roleName:@"XXXX~*" roleLevel:1015089810 gameCno:[[NSUUID UUID] UUIDString] extraData:@"20200812173525800013888" onCompletionHandler:^(int code, NSString * _Nonnull msg) {
         if (code == 0) {
               //msg will be the product  transactionId of the product if successful
               NSLog(@"**purchased successfully,the apple order id is %@",msg);
           }
//user cancels payment
         else if (code == -223){
             NSLog(@"**user cancels the purchase");
         }
//failed to purchase
        else {
            NSLog(@"failed to purchase,msg :%@",msg);
               dispatch_async(dispatch_get_main_queue(), ^{
//弹窗提示支付失败的msg,如游戏需要使用自身的弹框提示，可以注释掉此行showMessage代码
                   [R2SDKUtils showMessage:msg duration:5];
               });
           }
    }];
```

